# JIT - RITSEC-CTF-2019 - jitcalc - 4/14/21
this challenge is called JIT calc, which should make it obvious on what we will be
attempting to exploit today. I was going to do a flash 1-day POC, but my internet is
terrible today and i underestimated the size of a windows 7 ova :(

anyways, this is an incredibly interesting challenge as well, as this is going to be my
first time playing around with a Just In Time Compiler(JIT). The basis behind this method of
compilation, is that nothing will be strictly compiled, until required in that moment of time.
So this means that if the program is absolutely massive, it will be much more optimal to only
compile what you need. There are many advantages and disadvantages with using JIT, as with
every approach in computing, in which i will attempt to explain to the best of my ability.

JIT compilers are found quite literally everywhere, some of these include JVM, browsers, emulators,
.NET, and anything else that prefers dynamic code generations over statically compiling and running.
JIT compilers will cause a noticeable delay in the initial execution of an application, due to the
time taken to load and compile the bytecode. This means that JIT heavily relies on optimization
to be implemented, which will lead to security vulnerabilities. Here is a little writeup on
the basics of JIT optimization and compilation:
https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/underst_jit.html

the vulnerability within the binary is inside of the insecure usage of our write and run code
functions. When we "3: Write Constant Value", the instruction is interpreted like this:

movabs rax, 0xdeadbeef

in which it is a 10 byte opcode from nasmshell, lets check our "2: Write Addition" option:

1: Add Register 1 to Register 2
2: Add Register 2 to Register 1
3: Add Register 1 to Register 1
4: Add Register 2 to Register 2

we have the option to add register 1, into register 2, 2 into 1, 1 into 1, and 2 into 2. Lets see
what this would look like in x86_64 assembler:

add    rbx,rax
add    rax,rbx
add    rax,rax
add    rbx,rbx

we can use this to misalign our IP instruction pointer with the size of our opcodes.
